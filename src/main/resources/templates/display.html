<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Records</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/styles.css}">

    <script defer th:src="@{/js/messageHandler.js}"></script>
    <script defer th:src="@{/js/displayPopup.js}"></script>
    <script defer th:src="@{/js/animation.js}"></script>
</head>
<body>
<header class="header_container">
    <img th:src="@{/images/logo.svg}" alt="iACADEMY Logo">
    <div class="navBar">
        <p>Admin</p>
        <p>Faculty</p>
        <p class="active">Student</p>
        <p>Non-Teaching Staff</p>
        <p>Logout</p>
    </div>
</header>

<div class="mainWrapper">
    <div class="featuresContainer">
        <div class="title">
            <h1>Student Records</h1>
        </div>

        <form class="searchBar" th:action="@{/}" method="get">
            <input type="text" placeholder="Search by name, program, or year level..." name="search" th:value="${search}">
            <button type="submit">
                <i class="fa fa-search"></i>
            </button>
            <a th:if="${search != null && search != ''}" th:href="@{/}" class="clearSearch" title="Clear search">
                <i class="fa fa-times"></i>
            </a>
        </form>

        <a th:href="@{/form}" class="submitBtn" style="text-decoration: none; padding: 0.5rem 1rem; margin-left: 1rem;">Add Student</a>
    </div>

    <div class="studentData">
        <div class="topContainer">
            <div class="message">
                <p th:if="${search != null && search != ''}">
                    Search results for "<span th:text="${search}"></span>": Page <span th:text="${currentPage}"></span> of <span th:text="${totalPages}"></span> (<span th:text="${totalItems}"></span> found)
                </p>
                <p th:unless="${search != null && search != ''}">
                    Page <span th:text="${currentPage}"></span> of <span th:text="${totalPages}"></span> (<span th:text="${totalItems}"></span> total records)
                </p>
            </div>

            <div class="sessionMessage">
                <div th:if="${message}" th:text="${message}"
                     th:class="${'message ' + messageType}"></div>
            </div>

            <div class="pageController">
                <a th:if="${currentPage > 1}" th:href="@{/(page=${currentPage - 1}, search=${search})}" class="prevPage">
                    <button><i class="fa fa-chevron-left"></i></button>
                </a>
                <button th:unless="${currentPage > 1}" class="prevPage" disabled>
                    <i class="fa fa-chevron-left"></i>
                </button>

                <span class="pageInfo">Page <span th:text="${currentPage}"></span> of <span th:text="${totalPages}"></span></span>

                <a th:if="${currentPage < totalPages}" th:href="@{/(page=${currentPage + 1}, search=${search})}" class="nextPage">
                    <button><i class="fa fa-chevron-right"></i></button>
                </a>
                <button th:unless="${currentPage < totalPages}" class="nextPage" disabled>
                    <i class="fa fa-chevron-right"></i>
                </button>
            </div>
        </div>

        <table class="dataTable">
            <thead>
            <tr>
                <th>Picture</th>
                <th>ID</th>
                <th>Full Name</th>
                <th>Date of Birth</th>
                <th>Gender</th>
                <th>Program</th>
                <th>Year Level</th>
                <th>Contact Number</th>
                <th>Email</th>
                <th>Date Registered</th>
                <th></th>
            </tr>
            </thead>
            <tbody id="studentTableBody">
            <tr th:if="${#lists.isEmpty(listStudents)}">
                <td colspan="11" style="text-align: center; padding: 2rem;">
                    No student records found. <a th:href="@{/form}">Add a student</a>
                </td>
            </tr>
            <tr th:each="student : ${listStudents}">
                <td>
                    <img th:src="@{'/image/' + ${student.id}}"
                         alt="Student Picture"
                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd;"
                         onerror="this.src='data:image/svg+xml;base64,...(your placeholder)...';">
                </td>
                <td th:text="${student.id}"></td>
                <td th:text="${student.fullName}"></td>
                <td th:text="${student.dob}"></td>
                <td th:text="${student.gender}"></td>
                <td th:text="${student.course}"></td>
                <td th:text="${student.yearLevel}"></td>
                <td th:text="${student.contactNumber}"></td>
                <td th:text="${student.email}"></td>
                <td th:text="${#temporals.format(student.createdAt, 'yyyy-MM-dd')}"></td>
                <td>
                    <div class="buttonCont">
                        <a th:href="@{/update/{id}(id=${student.id})}"><button>Update</button></a>
                        <a th:href="@{/delete/{id}(id=${student.id})}" onclick="return confirm('Are you sure you want to delete this student?')"><button>Delete</button></a>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<canvas id="circleAnimation"></canvas>
</body>
</html>