<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Records</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/styles.css}">

    <script defer th:src="@{/js/displayPopup.js}"></script>
    <script defer th:src="@{/js/animation.js}"></script>
</head>
<body>
<header class="header_container">
    <img th:src="@{/images/logo.svg}" alt="iACADEMY Logo">
    <div class="navBar">
        <p>Admin</p>
        <p>Faculty</p>
        <p class="active">Student</p>
        <p>Non-Teaching Staff</p>
        <p>Logout</p>
    </div>
</header>

<div class="mainWrapper">
    <div class="featuresContainer">
        <div class="title">
            <h1>Student Records</h1>
        </div>

        <form class="searchBar" th:action="@{/}" method="get">
            <input type="text" placeholder="Search by name, program, or year level..." name="search" th:value="${search}">
            <button type="submit">
                <i class="fa fa-search"></i>
            </button>
            <a th:if="${search != null && search != ''}" th:href="@{/}" class="clearSearch" title="Clear search">
                <i class="fa fa-times"></i>
            </a>
        </form>

        <a th:href="@{/form}" class="submitBtn" style="text-decoration: none; padding: 0.5rem 1rem; margin-left: 1rem;">Add Student</a>
    </div>

    <div class="studentData">
        <div class="topContainer">
            <div class="message">
                <p th:if="${search != null && search != ''}">
                    Search results for "<span th:text="${search}"></span>": Page <span th:text="${currentPage}"></span> of <span th:text="${totalPages}"></span> (<span th:text="${totalItems}"></span> found)
                </p>
                <p th:unless="${search != null && search != ''}">
                    Page <span th:text="${currentPage}"></span> of <span th:text="${totalPages}"></span> (<span th:text="${totalItems}"></span> total records)
                </p>
            </div>

            <div class="sessionMessage">
                <div th:if="${message}" th:text="${message}"
                     th:class="${'message ' + messageType}"></div>
            </div>

            <div class="pageController">
                <a th:if="${currentPage > 1}" th:href="@{/(page=${currentPage - 1}, search=${search})}" class="prevPage">
                    <button><i class="fa fa-chevron-left"></i></button>
                </a>
                <button th:unless="${currentPage > 1}" class="prevPage" disabled>
                    <i class="fa fa-chevron-left"></i>
                </button>

                <span class="pageInfo">Page <span th:text="${currentPage}"></span> of <span th:text="${totalPages}"></span></span>

                <a th:if="${currentPage < totalPages}" th:href="@{/(page=${currentPage + 1}, search=${search})}" class="nextPage">
                    <button><i class="fa fa-chevron-right"></i></button>
                </a>
                <button th:unless="${currentPage < totalPages}" class="nextPage" disabled>
                    <i class="fa fa-chevron-right"></i>
                </button>
            </div>
        </div>

        <div class="table-responsive">
            <table class="dataTable">
                <thead>
                <tr>
                    <th>Picture</th>
                    <th>ID</th>
                    <th>Full Name</th>
                    <th>Birthdate</th>
                    <th>Gender</th>
                    <th>Program</th>
                    <th>Year Level</th>
                    <th>Contact Number</th>
                    <th>Email</th>
                    <th>Date Registered</th>
                    <th></th>
                </tr>
                </thead>
                <tbody id="studentTableBody">
                <tr th:if="${#lists.isEmpty(listStudents)}">
                    <td colspan="11" style="text-align: center; padding: 2rem;">
                        No student records found. <a th:href="@{/form}">Add a student</a>
                    </td>
                </tr>
                <tr th:each="student : ${listStudents}">
                    <td>
                        <img th:src="@{'/image/' + ${student.id}}"
                             alt="Student Picture"
                             width="60"
                             height="60"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjZjBmMGYwIi8+Cjx0ZXh0IHg9IjMwIiB5PSIzNSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIxMCIgZmlsbD0iIzk5OSI+Tm8gSW1hZ2U8L3RleHQ+Cjwvc3ZnPg==';">
                    </td>
                    <td th:text="${student.id}"></td>
                    <td th:text="${student.fullName}"></td>
                    <td th:text="${student.birthdate}"></td>
                    <td th:text="${student.gender}"></td>
                    <td th:text="${student.course}"></td>
                    <td th:text="${student.yearLevel}"></td>
                    <td th:text="${student.contactNumber}"></td>
                    <td th:text="${student.email}"></td>
                    <td th:text="${#temporals.format(student.createdAt, 'yyyy-MM-dd')}"></td>
                    <td>
                        <div class="buttonCont">
                            <button th:onclick="'updateStudent(' + ${student.id} + ')'">Update</button>
                            <button th:onclick="'deleteStudent(' + ${student.id} + ')'">Delete</button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="successPopup" id="successPopup">
    <div class="popupContent">
        <div class="popupIcon">
            <i class="fas fa-check-circle" id="successIcon"></i>
            <i class="fas fa-exclamation-triangle" id="errorIcon"></i>
        </div>
        <div class="popupMessage">
            <h3 id="popupTitle">Success!</h3>
            <p id="popupText">Operation completed successfully!</p>
        </div>
        <div class="popupButtons">
            <button type="button" class="okBtn" id="okBtn">OK</button>
        </div>
    </div>
</div>

<div class="confirmationPopup" id="confirmationPopup">
    <div class="popupContent">
        <div class="popupIcon">
            <i class="fas fa-question-circle" id="questionIcon"></i>
        </div>
        <div class="popupMessage">
            <h3 id="confirmTitle">Confirm Delete</h3>
            <p id="confirmText">Are you sure you want to delete this student record? This action cannot be undone.</p>
        </div>
        <div class="popupButtons">
            <button type="button" class="cancelBtn" id="cancelDeleteBtn">CANCEL</button>
            <button type="button" class="confirmBtn" id="confirmDeleteBtn">DELETE</button>
        </div>
    </div>
</div>

<canvas id="circleAnimation"></canvas>
</body>
</html>